## Тестовое задание. TR Logic LLC
#### Условия запуска
> PHP5.6  
> Apache Module [mod_rewrite](https://httpd.apache.org/docs/current/mod/mod_rewrite.html)  
> JavaScript ES6  
> База даных MySQL с загруженными часовыми поясами.

#### Запуск
1) Создание БД [tr_logic](tr_logic.sql).
2) Указание констант в [настрйках](App/Config.php):  
    a) Хост на котором запускается приложение. Необходим для корректной установки cookie.
    ```php
    const HOST = 'testhost.loc';
    ```
    b) Данные по подключению к БД:
    ```php
    const MYSQL = [
            'host' => 'localhost',//Хост запуска
            'user' => '',//Пользователь
            'password' => '',//Пароль
            'db' => 'tr_logic',//Название БД
            'port' => '8123'//Порт
        ];
    ```
    c) Основные пути внутри проекта
    ```php
    const PATH = [
            //Полный путь к файлам проекта
            'include' => '/var/www/testhost.loc/',
            //путь к папке с аватаркам (должны быть права на запись в данную папку)
            'avatar' => '/var/www/testhost.loc/images/',
            //путь к аватарке по умолчанию
            'default_avatar' => '/var/www/testhost.loc/images/avatar.png',
            //Путь к шаблонам e-mail сообщений
            'mail' => '/var/www/testhost.loc/tpl/mail/'
        ];
    ```
    d) Дополнительные констаны (изменять не обязательно).
    ```php
    /**Данные для отправки писем пользователям через SMTP*/
    const SMTP = [
        'host' => 'ssl://smtp.yandex.ru',
        'port' => 465,
        'email' => 'logic.loc@yandex.ua',
        'pass' => 'sP031JQa53MnyudH'
    ];
    /**Часовой пояс приложения*/
    const TIMEZONE = [
        'php' => 'UTC',//Устанавливается через date_default_timezone_set
        'mysql' => '+00:00'//Устанавливается запросов в БД
    ];
    /**
     * Режим разработчика, если включен то будут выводится ошибки PHP
     * и ошибки БД
     */
    const DEV = true;
    ```

#### Общее описание реализации
Вся взаимосвязь клиент-сервер реализована посредством AJAX-запросов.
##### Смена языка
Пользователю доступно два языка: русский, английский. При первом посещении пользователем сайта язык опрделяется на 
основе заголовка Accept-Language - если первым указан русский язык, то язык интерфейса устанавливается "RU" 
иначе "EN". Язык интерфейса хранится в cookie "language".
##### Регистрация
Регистрация пользователей реализована через подтверждение email путем генерации пароля на стороне сервера и отправки его на указанный email. При регистрации пользователю доступны следующие поля ввода:
- Email
- Фамилия
- Имя
- Телефон
- Дата рождения  

Обязательные поля помечены звездочкой. 
Также есть возможность указания фото пользователя с ограничение в 500Kb. После валидации всех данных (на стороне JavaScript и PHP) п
ользователю отправляется письмо с данными для входа. Пароли хранятся в MD5 с дополнительной подстановкой
константного хэша (реализовано для защиты простых паролей в случае утечки БД).
Язык письма соответствует выбранному языку интерфейса. 
Письмо отправляется в верстке с альтернативным «текстовым» содержанием. Шаблоны писем лежат в 
папке [tpl/mail](tpl/mail)
##### Восстановление пароля
Восстановление пароля реализовано через генерацию
 нового временного пароля пользователю и отправки последнего на почту.
  Временный пароль активен в течении 30 минут после генерации. 
  До момента того как пользователь зайдет с новым паролем на сайт старый 
пароль не удаляется (защита от смены пароля сторонним пользователем).
##### Авторизация пользователя
При входе на сайт у пользователя проверяется значение cookie «auth», если значение установлено, то через таблицу userAuth проверяется авторизация пользователя.  
UserAuth содержит все «авторизации» пользователя, для возможности последнего быть авторизованным на нескольких устройствах одновременно.  
После авторизации записывается сессионная переменная «userId».
##### Профиль пользователя
Имеет аналогичный функционал "Регистрации" с возможностью изменения пароля 
и удаления аватарки (если такова установлена). Вывод аватарки реализован средствам PHP для защиты изображений
других пользователей.